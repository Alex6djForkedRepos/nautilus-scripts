#!/usr/bin/env bash
# shellcheck disable=SC2086
# install_keyboard_shortcut=F3

# Source the script '_common-functions.sh'.
SCRIPT_DIR=$(cd -- "$(dirname -- "${BASH_SOURCE[0]}")" &>/dev/null && pwd)
ROOT_DIR=$(grep --only-matching "^.*scripts[^/]*" <<<"$SCRIPT_DIR")
source "$ROOT_DIR/_common-functions.sh"

_main() {
    local input_files=""

    # Execute initial checks.
    _check_dependencies ""
    input_files=$(_get_files "par_type=all; par_max_items=20")
    _unset_global_variables_file_manager

    # Check if the first file is a binary file.
    local file_1=""
    file_1=$(cut -d "$FIELD_SEPARATOR" -f 1 <<<"$input_files")
    if [[ ! -d "$file_1" ]]; then
        if [[ "$(_get_file_encoding "$file_1")" == "binary" ]] && [[ -s "$file_1" ]]; then
            if _is_qt_desktop; then
                _check_dependencies "okteta"
                okteta -- $input_files &
            else
                _check_dependencies "ghex"
                ghex -- $input_files &
            fi
            exit 0
        fi
    fi

    # Run the main process.
    local available_app=""
    local apps=(
        "code"
        "geany"
        "gnome-text-editor"
        "gedit"
    )
    available_app=$(_get_available_app "apps")

    if [[ -z "$available_app" ]]; then
        available_app=$(_xdg_get_default_app "text/plain")
    fi

    $available_app -- $input_files &
}

_main "$@"
